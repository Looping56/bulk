<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO Club Manager Pro - 2026</title>
    <style>
        :root { --lego-red: #d1121b; --lego-blue: #0055ad; --lego-yellow: #ffcf00; --dark: #222; --gray: #f4f4f4; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--gray); margin: 0; color: #333; }
        
        /* Navigation & Header */
        header { background: var(--dark); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--lego-red); }
        .nav-menu { display: flex; gap: 10px; background: #333; padding: 10px; justify-content: center; }
        
        /* Layout */
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; border-radius: 12px; padding: 25px; shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #ddd; }
        .section { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }

        /* Composants */
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; text-transform: uppercase; }
        .btn-red { background: var(--lego-red); color: white; }
        .btn-blue { background: var(--lego-blue); color: white; }
        .btn-green { background: #237841; color: white; }
        .btn-outline { background: transparent; border: 2px solid #555; color: #555; }
        
        .piece-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .vignette-item { border: 1px solid #eee; padding: 10px; border-radius: 8px; text-align: center; background: #fff; }
        .vignette-item img { width: 80px; height: 80px; object-fit: contain; }
        
        .price-box { background: #f9f9f9; padding: 20px; border-radius: 10px; border-left: 5px solid var(--lego-blue); margin-top: 20px; }
        .total-highlight { font-size: 1.5em; color: var(--lego-red); font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold; font-size: 1.2em;">üß± LEGO CLUB PRO <span id="user-display"></span></div>
    <button class="btn btn-outline" style="color:white; border-color:white;" onclick="checkAdmin()">Admin üîí</button>
</header>

<div class="nav-menu">
    <button class="btn btn-blue" onclick="showSection('selection-init')">1. S√©lection (11 pi√®ces)</button>
    <button class="btn btn-blue" onclick="showSection('commande-finale')">2. Commande Finale</button>
</div>

<div class="container">

    <div id="auth" class="section active card">
        <h2>Bienvenue sur la Session 2026</h2>
        <p>Entrez votre nom pour commencer votre s√©lection de pi√®ces.</p>
        <input type="text" id="member-name" placeholder="Votre Nom / Pseudo" style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid #ddd; border-radius: 8px;">
        <button class="btn btn-red" style="width:100%; margin-top:15px;" onclick="startSession()">Commencer</button>
    </div>

    <div id="selection-init" class="section card">
        <h2>Ma S√©lection de 11 Pi√®ces</h2>
        <p>Saisissez les r√©f√©rences pour voir les vignettes.</p>
        <div id="draft-list" class="piece-grid">
            </div>
        <button class="btn btn-green" style="width:100%; margin-top:20px;" onclick="saveDraft()">Valider ma S√©lection</button>
    </div>

    <div id="commande-finale" class="section card">
        <h2>Bon de Commande Final</h2>
        <div id="final-catalogue">
            </div>

        <div class="price-box">
            <div>Sous-total : <span id="st-val">0.00</span> ‚Ç¨</div>
            <div>Frais de gestion (7%) : <span id="frais-val">0.00</span> ‚Ç¨</div>
            <hr>
            <div class="total-highlight">TOTAL FINAL : <span id="total-val">0.00</span> ‚Ç¨</div>
            <p id="budget-alert" style="color:red; display:none; font-weight:bold;">‚ö†Ô∏è Budget max (50‚Ç¨) d√©pass√© !</p>
        </div>
        <button id="btn-valider-tout" class="btn btn-green" style="width:100%; margin-top:20px;" onclick="validerCommandeFinale()">Confirmer & G√©n√©rer mon Bon</button>
    </div>

    <div id="admin-panel" class="section card">
        <h2 style="color:var(--lego-red)">Dashboard Administrateur</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="vignette-item">
                <h4>Import Catalogue</h4>
                <input type="file" id="csv-import" accept=".csv">
                <button class="btn btn-blue" onclick="processImport()">Uploader CSV</button>
            </div>
            <div class="vignette-item">
                <h4>Export Global</h4>
                <button class="btn btn-red" onclick="exportBricklink()">Fichier BrickLink</button>
            </div>
        </div>
        <div id="admin-stats" style="margin-top:20px;">
            </div>
    </div>

</div>



<script>
    let currentMember = "";
    const BUDGET_MAX = 50.00;

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startSession() {
        currentMember = document.getElementById('member-name').value;
        if(!currentMember) return alert("Nom requis");
        document.getElementById('user-display').innerText = `| Membre : ${currentMember}`;
        showSection('selection-init');
        initDraftGrid();
    }

    function initDraftGrid() {
        const grid = document.getElementById('draft-list');
        grid.innerHTML = "";
        for(let i=1; i<=11; i++) {
            grid.innerHTML += `
                <div class="vignette-item">
                    <img id="img-${i}" src="https://placehold.co/80x80?text=LEGO">
                    <input type="text" placeholder="R√©f ${i}" oninput="updateVignette(${i}, this.value)" style="width:80%; margin-top:5px;">
                </div>`;
        }
    }

    function updateVignette(id, ref) {
        if(ref.length > 2) {
            document.getElementById(`img-${id}`).src = `https://img.bricklink.com/ItemImage/PN/11/${ref}.png`;
        }
    }

    function checkAdmin() {
        const mdp = prompt("Mot de passe Admin :");
        if(mdp === "LEGO2026") showSection('admin-panel');
        else alert("Acc√®s refus√©");
    }

    function validerCommandeFinale() {
        // Logique de calcul finale
        const st = parseFloat(document.getElementById('st-val').innerText);
        const total = st * 1.07;
        
        alert(`Commande enregistr√©e pour ${currentMember}.\nTotal : ${total.toFixed(2)}‚Ç¨ (incluant 7% de frais).\nVotre bon de commande est pr√™t !`);
        // Ici appel vers app.py pour sauver en SQL
    }

    // Fonctions d'interface pour l'admin...
</script>
</body>
</html>
