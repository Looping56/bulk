<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lego Pro Manager - Commande & Admin</title>
    <style>
        :root { --lego-red: #d1121b; --lego-blue: #0055ad; --lego-yellow: #ffcf00; --dark: #222; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
        .app-container { max-width: 600px; margin: auto; background: white; border-radius: 15px; border: 5px solid var(--dark); overflow: hidden; }
        
        .header { background: var(--dark); color: white; padding: 20px; text-align: center; }
        .section { padding: 20px; display: none; }
        .active { display: block; }

        /* Style des Vignettes */
        .piece-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding: 5px; background: #eee; border-radius: 8px; }
        .vignette { width: 50px; height: 50px; background: #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        
        .btn { width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-blue { background: var(--lego-blue); }
        .btn-green { background: #237841; }
        .btn-admin { background: #666; }

        .admin-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2>LEGO SYSTEM PRO</h2>
        <div id="user-tag">Session : 2026</div>
    </div>

    <div id="menu" class="section active">
        <input type="text" id="member-name" placeholder="Votre Nom / Pseudo" style="width:94%; padding:15px; margin-bottom:10px;">
        <button class="btn btn-blue" onclick="showSection('selection')">1. S√©lectionner mes 11 pi√®ces</button>
        <button class="btn btn-green" onclick="genererBon()">2. G√©n√©rer mon Bon de Commande</button>
        <button class="btn btn-admin" onclick="checkAdmin()">Administration üîí</button>
    </div>

    <div id="selection" class="section">
        <h3>Ma S√©lection (11 pi√®ces)</h3>
        <div id="list-container"></div>
        <button class="btn btn-blue" onclick="saveSelection()">Enregistrer ma S√©lection</button>
        <button class="btn btn-admin" onclick="showSection('menu')">Retour</button>
    </div>

    <div id="admin" class="section">
        <h3>Panneau de Contr√¥le Final</h3>
        <div class="admin-controls">
            <button class="btn btn-green" onclick="exportData()">Exporter CSV (BrickLink)</button>
            <button class="btn btn-blue" onclick="importData()">Importer S√©lection Finale</button>
        </div>
        <div id="stats-area" style="margin-top:20px; padding:10px; background:#f9f9f9; border:1px solid #ccc;">
            <strong>Statistiques :</strong> <span id="total-orders">0</span> commandes en attente.
        </div>
        <button class="btn btn-admin" onclick="showSection('menu')">Quitter Admin</button>
    </div>
</div>

<script>
    // Initialisation des 11 lignes
    const list = document.getElementById('list-container');
    for(let i=1; i<=11; i++) {
        list.innerHTML += `
            <div class="piece-row">
                <div class="vignette" id="vignette-${i}">IMG</div>
                <input type="text" placeholder="R√©f" id="ref-${i}" style="width:60px" oninput="updateVignette(${i})">
                <select id="col-${i}" style="flex:1">
                    <option>Black</option><option>White</option><option>Red</option><option>Blue</option>
                </select>
            </div>`;
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function updateVignette(id) {
        const ref = document.getElementById(`ref-${id}`).value;
        const vig = document.getElementById(`vignette-${id}`);
        if(ref.length > 2) {
            // Ici on pourrait lier une image : bricklink.com/v2/catalog/catalogitem.page?P=${ref}
            vig.innerHTML = `<img src="https://img.bricklink.com/ItemImage/PN/11/${ref}.png" style="width:100%" onerror="this.src='Lego'">`;
        }
    }

    function checkAdmin() {
        const p = prompt("Mot de passe :");
        if(p === "admin123") showSection('admin');
    }

    function genererBon() {
    const nom = document.getElementById('member-name').value;
    if (!nom) {
        alert("Veuillez entrer votre nom avant de g√©n√©rer le bon !");
        return;
    }

    // On r√©cup√®re les donn√©es des 11 pi√®ces
    let lignesTableau = "";
    for (let i = 1; i <= 11; i++) {
        const ref = document.getElementById(`ref-${i}`).value || "---";
        const col = document.getElementById(`col-${i}`).value;
        const imgUrl = `https://img.bricklink.com/ItemImage/PN/11/${ref}.png`;
        
        lignesTableau += `
            <tr>
                <td>${i}</td>
                <td><img src="${imgUrl}" style="width:40px;" onerror="this.src='https://placehold.co/40x40?text=Lego'"></td>
                <td><strong>${ref}</strong></td>
                <td>${col}</td>
                <td>[ ]</td>
            </tr>`;
    }

    // On ouvre une nouvelle fen√™tre pour l'impression
    const fenetreImpression = window.open('', '', 'height=800,width=600');
    fenetreImpression.document.write(`
        <html>
            <head>
                <title>Bon de Commande - ${nom}</title>
                <style>
                    body { font-family: sans-serif; padding: 40px; }
                    .header { text-align: center; border-bottom: 3px solid #d1121b; padding-bottom: 20px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
                    th { background-color: #f2f2f2; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; }
                    .sign-box { border: 1px solid #000; width: 200px; height: 100px; padding: 10px; font-size: 0.8em; }
                    @media print { .no-print { display: none; } }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>BON DE COMMANDE LEGO 2026</h1>
                    <p>Membre : <strong>${nom.toUpperCase()}</strong> | Date : ${new Date().toLocaleDateString()}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Aper√ßu</th>
                            <th>R√©f√©rence</th>
                            <th>Couleur</th>
                            <th>Re√ßu</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${lignesTableau}
                    </tbody>
                </table>
                <div class="footer">
                    <div class="sign-box">Signature Membre :</div>
                    <div class="sign-box">Validation Admin :</div>
                </div>
                <br>
                <button class="no-print" onclick="window.print()" style="padding:10px 20px; background:#237841; color:white; border:none; cursor:pointer;">Imprimer le Bon</button>
          
    `);
    fenetreImpression.document.close();
}
<div id="commande-finale" class="section">
    <h3>Validation du Panier Final</h3>
    <p style="font-size: 0.8em; color: #666;">Prix maximum autoris√© : <span id="budget-max">50.00</span> ‚Ç¨</p>
    
    <div id="liste-finale">
        <div class="piece-row fixed">
            <span>Fixe 1: R√©f 3001 (0.20‚Ç¨)</span>
            <input type="number" id="qte-f1" value="1" min="0" onchange="calculerTotal()">
        </div>
        <div class="piece-row special">
            <span>TOP 1: R√©f 4073 (0.05‚Ç¨)</span>
            <input type="number" id="qte-top" value="0" min="0" onchange="calculerTotal()">
        </div>
    </div>

    <div style="background: #eee; padding: 15px; margin-top: 15px; border-radius: 8px;">
        <div>Sous-total : <span id="sous-total">0.00</span> ‚Ç¨</div>
        <div>Frais de gestion (7%) : <span id="frais">0.00</span> ‚Ç¨</div>
        <div style="font-weight:bold; color:var(--lego-red); font-size: 1.2em;">
            PRIX TOTAL : <span id="prix-final">0.00</span> ‚Ç¨
        </div>
    </div>

    <button id="btn-valider-final" class="btn btn-green" onclick="validerEtEnvoyer()">Valider et Envoyer R√©cap</button>
</div>

<script>
    const FRAIS_POURCENTAGE = 0.07;
    const BUDGET_MAX = 50.00; // √Ä d√©finir par l'Admin

    function calculerTotal() {
        // Exemple simplifi√© de calcul
        let st = (document.getElementById('qte-f1').value * 0.20) + 
                 (document.getElementById('qte-top').value * 0.05);
        
        let f = st * FRAIS_POURCENTAGE;
        let total = st + f;

        document.getElementById('sous-total').innerText = st.toFixed(2);
        document.getElementById('frais').innerText = f.toFixed(2);
        document.getElementById('prix-final').innerText = total.toFixed(2);

        // Alerte si d√©passement budget
        const btn = document.getElementById('btn-valider-final');
        if (total > BUDGET_MAX) {
            btn.style.background = "#ccc";
            btn.disabled = true;
            btn.innerText = "Budget D√©pass√© !";
        } else {
            btn.style.background = "var(--lego-green)";
            btn.disabled = false;
            btn.innerText = "Valider et Envoyer R√©cap";
        }
    }

    function validerEtEnvoyer() {
        const nom = document.getElementById('member-name').value;
        const total = document.getElementById('prix-final').innerText;
        
        // Simule l'envoi d'un email ou message r√©capitulatif
        alert(`R√©capitulatif envoy√© √† l'adh√©rent : ${nom}\nTotal : ${total} ‚Ç¨ (incluant 7% de frais)`);
        
        // Ici, on d√©clenche l'impression du bon de commande finale
        genererBon(); 
    }

<div class="card" style="border-left: 5px solid var(--lego-yellow);">
    <h3>üìä Statistiques de la Session 2026</h3>
    <div id="stats-summary" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
        <div style="background:#f9f9f9; padding:15px; border-radius:10px;">
            <small>Total Collect√© (Frais 7%)</small>
            <div id="total-frais-club" style="font-size:1.5em; font-weight:bold; color:var(--lego-blue);">0.00 ‚Ç¨</div>
        </div>
        <div style="background:#f9f9f9; padding:15px; border-radius:10px;">
            <small>Volume d'Achat Global</small>
            <div id="volume-global" style="font-size:1.5em; font-weight:bold;">0.00 ‚Ç¨</div>
        </div>
        <div style="background:#f9f9f9; padding:15px; border-radius:10px;">
            <small>Membre le plus Actif</small>
            <div id="top-membre" style="font-size:1.1em; font-weight:bold; color:var(--lego-red);">--</div>
        </div>
    </div>
</div>


</script>
</body>
</html>
